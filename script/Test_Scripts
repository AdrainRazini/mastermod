-- Verificar se já existe um ScreenGui com o nome "AimbotV2"
local existingScreenGui = game.Players.LocalPlayer:WaitForChild("PlayerGui"):FindFirstChild("AimbotV2")
if existingScreenGui then return end

-- Notificação de carregamento
game:GetService("StarterGui"):SetCore("SendNotification", { 
    Title = "Mastermod";
    Text = "AimBot V2";
    Icon = "rbxthumb://type=Asset&id=72684486485553&w=150&h=150",
    Duration = 16
})

local player = game.Players.LocalPlayer
local players = game:GetService("Players")
local runService = game:GetService("RunService")
local camera = game.Workspace.CurrentCamera

local detectionRadius = 50
local lerpSpeed = 0.1
local aimEnabled = true
local targetMode = "Todos" -- "Todos", "Inimigos", "NPCs"

local screenGui

function createUI()
    if screenGui then screenGui:Destroy() end

    screenGui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
    screenGui.Name = "AimbotV2"
    screenGui.ResetOnSpawn = false

    local mainFrame = Instance.new("Frame", screenGui)
    mainFrame.Name = "MainFrame"
    mainFrame.Size = UDim2.new(0, 220, 0, 180)
    mainFrame.Position = UDim2.new(0, 100, 0, 100)
    mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    mainFrame.BorderSizePixel = 0
    mainFrame.Active = true
    mainFrame.Draggable = true

    local titleBar = Instance.new("TextLabel", mainFrame)
    titleBar.Size = UDim2.new(1, 0, 0, 25)
    titleBar.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
    titleBar.Text = "Aimbot V2"
    titleBar.TextColor3 = Color3.new(1, 1, 1)
    titleBar.Font = Enum.Font.SourceSansBold
    titleBar.TextSize = 18
    titleBar.TextXAlignment = Enum.TextXAlignment.Left
    titleBar.PaddingLeft = UDim.new(0, 8)

    local minimizeButton = Instance.new("TextButton", mainFrame)
    minimizeButton.Size = UDim2.new(0, 25, 0, 25)
    minimizeButton.Position = UDim2.new(1, -25, 0, 0)
    minimizeButton.Text = "-"
    minimizeButton.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
    minimizeButton.TextColor3 = Color3.new(1, 1, 1)
    minimizeButton.Font = Enum.Font.SourceSansBold
    minimizeButton.TextSize = 18

    local contentFrame = Instance.new("Frame", mainFrame)
    contentFrame.Size = UDim2.new(1, 0, 1, -25)
    contentFrame.Position = UDim2.new(0, 0, 0, 25)
    contentFrame.BackgroundTransparency = 1

    -- Botão: Ativar/desativar mira
    local toggleButton = Instance.new("TextButton", contentFrame)
    toggleButton.Size = UDim2.new(1, -20, 0, 30)
    toggleButton.Position = UDim2.new(0, 10, 0, 10)
    toggleButton.Text = "Desativar Mira"
    toggleButton.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    toggleButton.TextColor3 = Color3.new(1, 1, 1)
    toggleButton.Font = Enum.Font.SourceSans
    toggleButton.TextSize = 16
    toggleButton.MouseButton1Click:Connect(function()
        aimEnabled = not aimEnabled
        toggleButton.Text = aimEnabled and "Desativar Mira" or "Ativar Mira"
    end)

    -- Caixa: Distância da mira
    local distanceSlider = Instance.new("TextBox", contentFrame)
    distanceSlider.Size = UDim2.new(1, -20, 0, 30)
    distanceSlider.Position = UDim2.new(0, 10, 0, 50)
    distanceSlider.Text = tostring(detectionRadius)
    distanceSlider.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    distanceSlider.TextColor3 = Color3.new(1, 1, 1)
    distanceSlider.Font = Enum.Font.SourceSans
    distanceSlider.TextSize = 16
    distanceSlider.ClearTextOnFocus = false
    distanceSlider.FocusLost:Connect(function()
        local newDistance = tonumber(distanceSlider.Text)
        if newDistance then
            detectionRadius = math.clamp(newDistance, 10, 200)
        else
            distanceSlider.Text = tostring(detectionRadius)
        end
    end)

    -- Botão: Alternar modo de mira
    local targetModeButton = Instance.new("TextButton", contentFrame)
    targetModeButton.Size = UDim2.new(1, -20, 0, 30)
    targetModeButton.Position = UDim2.new(0, 10, 0, 90)
    targetModeButton.Text = "Mirar em Todos"
    targetModeButton.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    targetModeButton.TextColor3 = Color3.new(1, 1, 1)
    targetModeButton.Font = Enum.Font.SourceSans
    targetModeButton.TextSize = 16
    targetModeButton.MouseButton1Click:Connect(function()
        if targetMode == "Todos" then
            targetMode = "Inimigos"
        elseif targetMode == "Inimigos" then
            targetMode = "NPCs"
        else
            targetMode = "Todos"
        end

        targetModeButton.Text =
            targetMode == "Todos" and "Mirar em Todos" or
            targetMode == "Inimigos" and "Mirar na Equipe Inimiga" or
            "Mirar em NPCs"
    end)

    -- Minimizar
    local minimized = false
    minimizeButton.MouseButton1Click:Connect(function()
        minimized = not minimized
        contentFrame.Visible = not minimized
        minimizeButton.Text = minimized and "+" or "-"
        mainFrame.Size = minimized and UDim2.new(0, 220, 0, 25) or UDim2.new(0, 220, 0, 180)
    end)
end

function findClosestPlayer()
    if not aimEnabled then return nil end

    local character = player.Character
    if not character then return nil end

    local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
    if not humanoidRootPart then return nil end

    local closestPlayer = nil
    local closestDistance = detectionRadius

    for _, p in ipairs(players:GetPlayers()) do
        if p ~= player and p.Character then
            local isEnemy = p.Team ~= player.Team
            local isNPC = p.Team == nil

            if targetMode == "Inimigos" and not isEnemy then
                continue
            elseif targetMode == "NPCs" and not isNPC then
                continue
            elseif targetMode == "Todos" and p.Team == player.Team then
                continue
            end

            local head = p.Character:FindFirstChild("Head")
            if head then
                local distance = (humanoidRootPart.Position - head.Position).magnitude
                if distance < closestDistance then
                    closestDistance = distance
                    closestPlayer = p
                end
            end
        end
    end

    return closestPlayer
end

function aimAt(target)
    if not aimEnabled or not target or not target.Character then return end

    local head = target.Character:FindFirstChild("Head")
    if head then
        local targetPosition = head.Position
        local cameraLookAt = CFrame.new(camera.CFrame.Position, targetPosition)
        camera.CFrame = cameraLookAt:Lerp(camera.CFrame, lerpSpeed)
    end
end

-- Inicialização
local function onCharacterAdded(character)
    createUI()
end

player.CharacterAdded:Connect(onCharacterAdded)
if player.Character then
    onCharacterAdded(player.Character)
end

-- Mira contínua
runService.RenderStepped:Connect(function()
    local targetPlayer = findClosestPlayer()
    aimAt(targetPlayer)
end)
